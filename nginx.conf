events {
  worker_connections 1024;
}

http {
  upstream auth_service {
    server auth-service:3001;
  }

  upstream board_service {
    server board-service-1:3000;
    server board-service-2:3000;
    server board-service-3:3000;
  }

  server {
    listen 80;

    # Auth 서비스 헬스체크 (신규 추가)
    location /auth/health {
      proxy_pass http://auth_service/health;
      proxy_set_header Host $host;
    }

    # Auth 서비스 메트릭 (신규 추가)
    location /auth/metrics {
      proxy_pass http://auth_service/metrics;
      proxy_set_header Host $host;
    }

    # Auth 서비스 라우팅
    location /auth/ {
      proxy_pass http://auth_service/auth/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Auth Swagger
    location /auth/api {
      proxy_pass http://auth_service/api;
      proxy_set_header Host $host;
    }

    # Board 서비스 헬스체크 (신규 추가)
    location /health {
      proxy_pass http://board_service;
      proxy_set_header Host $host;
    }

    # Board 서비스 메트릭 (신규 추가)
    location /metrics {
      proxy_pass http://board_service;# 뒤에 /metrics를 뺍니다.
      proxy_set_header Host $host;
    }

    # Board Swagger
    location /api {
      proxy_pass http://board_service/api;
      proxy_set_header Host $host;
    }

    # Board 서비스 라우팅 (기본)
    location / {
      proxy_pass http://board_service/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
  }
}
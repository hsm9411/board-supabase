# ğŸš€ Scalable Bulletin Board System (Nest.js + Supabase + Docker)

ì´ í”„ë¡œì íŠ¸ëŠ” **Nest.js**ì™€ **Supabase(PostgreSQL)**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ëœ í™•ì¥ ê°€ëŠ¥í•œ ê²Œì‹œíŒ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
ë‹¨ìˆœí•œ CRUDë¥¼ ë„˜ì–´ **Docker**ì™€ **Nginx**ë¥¼ í™œìš©í•œ ë¡œë“œ ë°¸ëŸ°ì‹± í™˜ê²½(Replica x3)ì„ êµ¬ì¶•í•˜ì˜€ìœ¼ë©°, íŠ¸ë˜í”½ ë¶„ì‚° ì²˜ë¦¬ì™€ ë°ì´í„° ë³´ì•ˆ ìµœì í™”ë¥¼ ì‹¤ë®¬ë ˆì´ì…˜í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

- **ëª©í‘œ:** ê³ ê°€ìš©ì„±(High Availability) ë° í™•ì¥ì„±ì„ ê³ ë ¤í•œ ë°±ì—”ë“œ ì•„í‚¤í…ì²˜ êµ¬ì¶•
- **í•µì‹¬ ì•„í‚¤í…ì²˜:**
    - **Client** â†’ **Nginx (Load Balancer)** â†’ **Nest.js Server (x3 Replicas)** â†’ **Supabase (DB)**
- **íŠ¹ì§•:**
    - Round-Robin ë°©ì‹ì˜ ë¶€í•˜ ë¶„ì‚° ì²˜ë¦¬
    - JWT ê¸°ë°˜ ì¸ì¦ ë° Guardë¥¼ í†µí•œ ë³´ì•ˆ ê°•í™”
    - TypeORM ê´€ê³„ ì„¤ì •(1:N) ë° QueryBuilder ìµœì í™”
    - **Swagger (OpenAPI)**ë¥¼ í†µí•œ ì¸í„°ë™í‹°ë¸Œ API ë¬¸ì„œí™”

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡° (Project Structure)

ì´í•´ë¥¼ ë•ê¸° ìœ„í•œ ì „ì²´ ë””ë ‰í† ë¦¬ ë° ì£¼ìš” íŒŒì¼ êµ¬ì¡°ì…ë‹ˆë‹¤.

```text
.
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ auth                    # ì¸ì¦ ë° ì¸ê°€ (JWT, Passport, Strategy)
â”‚   â”‚   â”œâ”€â”€ dto                 # ì „ìš© DTO (SignUp, SignIn)
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â””â”€â”€ get-user.decorator.ts
â”‚   â”œâ”€â”€ board                   # ê²Œì‹œíŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (CRUD)
â”‚   â”‚   â”œâ”€â”€ dto                 # CreatePost, GetPosts(í˜ì´ì§•/ê²€ìƒ‰) DTO
â”‚   â”‚   â”œâ”€â”€ board.controller.ts
â”‚   â”‚   â””â”€â”€ board.service.ts
â”‚   â”œâ”€â”€ entities                # DB ìŠ¤í‚¤ë§ˆ ì •ì˜ (TypeORM)
â”‚   â”‚   â”œâ”€â”€ user.entity.ts      # User ì—”í‹°í‹° (ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸ ì ìš©)
â”‚   â”‚   â””â”€â”€ post.entity.ts      # Post ì—”í‹°í‹° (ì‘ì„±ì ê´€ê³„ ì„¤ì •)
â”‚   â”œâ”€â”€ app.module.ts           # ì „ì—­ ëª¨ë“ˆ ë° DB ì—°ê²° ì„¤ì •
â”‚   â””â”€â”€ main.ts                 # ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ (ì „ì—­ íŒŒì´í”„, ì¸í„°ì…‰í„°, Swagger)
â”œâ”€â”€ test                        # í…ŒìŠ¤íŠ¸ ì½”ë“œ (E2E, Unit)
â”œâ”€â”€ nginx.conf                  # Nginx ë¡œë“œë°¸ëŸ°ì‹± ì„¤ì • íŒŒì¼
â”œâ”€â”€ Dockerfile                  # ì»¨í…Œì´ë„ˆ ë¹Œë“œë¥¼ ìœ„í•œ ì„¤ì •
â”œâ”€â”€ docker-compose.yml          # ì¸í”„ë¼ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ (App x3, Nginx)
â””â”€â”€ supabase_rls.sql            # DB ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ RLS ì •ì±… ìŠ¤í¬ë¦½íŠ¸
```

---

## âœ¨ ê¸°ìˆ ì  ê°œì„  ë° ë¦¬íŒ©í† ë§ ë‚´ì—­ (Key Improvements)

ê¸°ì¡´ ì½”ë“œì˜ êµ¬ì¡°ì  ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ê³ , í˜„ì—… ìˆ˜ì¤€ì˜ ì™„ì„±ë„ë¥¼ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ë¦¬íŒ©í† ë§ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

1.  **í‘œì¤€ ì˜ˆì™¸ ì²˜ë¦¬ (Standard Exceptions)**:
    - ë‹¨ìˆœí•œ ì—ëŸ¬ ë°˜í™˜ì´ ì•„ë‹Œ, ìƒí™©ì— ë§ëŠ” HTTP ìƒíƒœ ì½”ë“œ(`409 Conflict`, `403 Forbidden` ë“±)ë¥¼ ì‚¬ìš©í•˜ì—¬ APIì˜ ëª…í™•ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.
2.  **ë°ì´í„° ë³´ì•ˆ ê°•í™” (Security)**:
    - `ClassSerializerInterceptor`ì™€ `@Exclude()` ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬, API ì‘ë‹µ ì‹œ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œê°€ ë…¸ì¶œë˜ëŠ” ë³´ì•ˆ ìœ„í˜‘ì„ ì›ì²œ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.
3.  **ë°ì´í„° ê´€ê³„ ë° ì„±ëŠ¥ ìµœì í™”**:
    - ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ ì‹œ ì‘ì„±ì(`author`) ì •ë³´ë¥¼ ë¡œë“œí•  ë•Œ `leftJoinAndSelect`ë¥¼ í™œìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì¿¼ë¦¬ ë°œìƒì„ ì¤„ì´ê³  ë°ì´í„° ì™„ì„±ë„ë¥¼ ë†’ì˜€ìŠµë‹ˆë‹¤.
4.  **DTO êµ¬ì¡°í™” ë° ìœ íš¨ì„± ê²€ì‚¬**:
    - ê° ëª©ì ì— ë§ëŠ” ì „ìš© DTOë¥¼ ìƒì„±í•˜ê³  `class-validator`ë¥¼ ì ìš©í•˜ì—¬ ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.
5.  **Swagger UI ê³ ë„í™”**:
    - ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì— ìƒì„¸í•œ ì„¤ëª…ê³¼ ì˜ˆì‹œ ê°’, ì‘ë‹µ íƒ€ì…ì„ ì •ì˜í•˜ì—¬ ê°œë°œì ì¹œí™”ì ì¸ ë¬¸ì„œë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.
6.  **í™˜ê²½ ì„¤ì • ë¶„ë¦¬ (NODE_ENV)**:
    - `NODE_ENV` ë³€ìˆ˜ë¥¼ ë„ì…í•˜ì—¬ ê°œë°œ í™˜ê²½ì—ì„œë§Œ Swaggerê°€ í™œì„±í™”ë˜ë„ë¡ ì œì–´í•˜ê³  ë³´ì•ˆì„±ì„ ê°•í™”í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ›¡ï¸ [DB ë³´ì•ˆ ê°€ì´ë“œ] Row Level Security (RLS)

Supabaseë¥¼ ë”ìš± ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì ìš©ëœ **RLS** ê°œë…ì„ ì†Œê°œí•©ë‹ˆë‹¤.

### 1. RLSë€ ë¬´ì—‡ì¸ê°€ìš”? ğŸ’¡
**í–‰ ë‹¨ìœ„ ë³´ì•ˆ(Row Level Security)**ì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì—ì„œ "íŠ¹ì • ì¡°ê±´(í–‰)ì— ë§ëŠ” ë°ì´í„°ì—ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ" ì§ì ‘ ì œì•½í•˜ëŠ” ë¬¼ë¦¬ì ì¸ ë°©ì–´ë§‰ì…ë‹ˆë‹¤.

-   **ì§ê´€ì  ë¹„ìœ  (í˜¸í…” ì¹´ë“œí‚¤)**:
    -   **NestJS ì„œë²„ (í”„ëŸ°íŠ¸ ë°ìŠ¤í¬)**: ì†ë‹˜ì˜ ì‹ ë¶„ì¦ì„ í™•ì¸í•˜ê³  ì²´í¬ì¸ì„ ë•ìŠµë‹ˆë‹¤.
    -   **RLS (ê°ì‹¤ ì¹´ë“œí‚¤)**: ì²´í¬ì¸ì„ í–ˆë”ë¼ë„(ë¡œê·¸ì¸ ì„±ê³µ), **ìì‹ ì˜ ì¹´ë“œí‚¤**ê°€ ì—†ìœ¼ë©´ ë‹¤ë¥¸ ì†ë‹˜ì˜ ë°©(ë°ì´í„°)ì—ëŠ” ë“¤ì–´ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
-   **ì™œ í•„ìš”í•œê°€ìš”?**: ì„œë²„ ì½”ë“œì— ì‹¤ìˆ˜ê°€ ìˆë”ë¼ë„, DB ë ˆë²¨ì—ì„œ "ë³¸ì¸ ê¸€ì´ ì•„ë‹ˆë©´ ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€"ë¼ëŠ” ê·œì¹™ì´ í•œ ë²ˆ ë” ë³´í˜¸í•´ì£¼ê¸° ë•Œë¬¸ì— í›¨ì”¬ ì•ˆì „í•©ë‹ˆë‹¤. (**ì‹¬ì¸µ ë°©ì–´**)

### 2. ì„¤ì • ë°©ë²• (How-to)
1.  **Supabase ëŒ€ì‹œë³´ë“œ** ì ‘ì† -> [SQL Editor] ë©”ë‰´ë¡œ ì´ë™.
2.  í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ `supabase_rls.sql` íŒŒì¼ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ì‹¤í–‰.
3.  [Authentication] -> [Policies] íƒ­ì—ì„œ í™œì„±í™”ëœ ì •ì±… í™•ì¸.

---

## âš™ï¸ í™˜ê²½ ì„¤ì • ë° ì‹¤í–‰ ë°©ë²• (Getting Started)

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (.env)
ë£¨íŠ¸ ê²½ë¡œì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.

```ini
NODE_ENV="development" # í•„ìˆ˜ (Swagger ë° ê°œë°œ ëª¨ë“œ í™œì„±í™”)
DATABASE_URL="postgresql://postgres:[PASSWORD]@[HOST]:5432/[DB_NAME]"
JWT_SECRET="your_super_secret_key"
TZ="Asia/Seoul"
```

### 2. ì‹¤í–‰ (Docker)
```bash
# ì»¨í…Œì´ë„ˆ ë¹Œë“œ ë° ì‹¤í–‰
docker-compose up --build
```

---

## ğŸ”Œ API ëª…ì„¸ ë° ë¬¸ì„œí™”

### ğŸ“– Swagger API ë¬¸ì„œ
ì„œë²„ê°€ ì‹¤í–‰ë˜ë©´ ì•„ë˜ ì£¼ì†Œë¥¼ í†µí•´ ëŒ€í™”í˜• ë¬¸ì„œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì ‘ì† ì£¼ì†Œ:** `http://localhost/api`

### ğŸ” ì£¼ìš” API ë¦¬ìŠ¤íŠ¸
- **ì¸ì¦ (Auth)**: `/auth/signup`, `/auth/signin`
- **ê²Œì‹œíŒ (Board)**:
  - `GET /board` (ì „ì²´ ì¡°íšŒ, í˜ì´ì§•/ê²€ìƒ‰ í¬í•¨)
  - `GET /board/my` (ë‚´ê°€ ì“´ ê¸€ ëª©ë¡)
  - `POST /board`, `PATCH /board/:id`, `DELETE /board/:id`

---

**Author:** [Your Name/ID]
**Last Updated:** 2026-01-26
